<!DOCTYPE html>
<head>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
    rel="stylesheet"
  />
</head>
<html>
  <body>
    <header class="head"><h1>Budget Man</h1></header>

    <div class="info">
      <ul id="bits">
        <li>loading items...</li>
      </ul>
    </div>

    <section>
      <form class="formData">
        <div class="formArea">
          <label for="name">Enter item purchased: </label>
          <input type="text" name="item" id="item" />
        </div>
        <div class="formArea">
          <label for="name">Enter your item cost: </label>
          <input type="text" name="dollar" id="dollar" />
        </div>
        <input class="button" type="submit" value="Add Item" />
      </form>
      <div class="total">
        <input class="button" type="submit" value="Add total" />
      </div>
    </section>
    <div>
      <ul class="bits" id="totalArea"></ul>
    </div>
    <script>
      // try and make the money add up and figure out why emoji is not working
      const addItems = document.querySelector(".formData");
      const itemsList = document.querySelector(".bits");
      const total = document.querySelector(".total");
      // items are not ready on page load so here we look at storage or load empty array, this will persist the data after reload
      const items = JSON.parse(localStorage.getItem("items")) || [];
      let numbUSD = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
      });
      function addItem(e) {
        e.preventDefault();
        const text = this.querySelector("[name=item]").value;
        const price = this.querySelector("[name=dollar]").value;

        const item = {
          text,
          price,
          done: false,
        };
        // this pull a regular number but the the add money function price pulls the actual money value?
        //console.log(items);
        items.push(item);
        populateList(items, itemsList);
        /// setting items in localStorage need to stringify as localStorage only accepts strings
        localStorage.setItem("items", JSON.stringify(items));
        this.reset();
      }

      // got the money to loop need to see if we can unformat it then add and reformat or just add the money?
      // trying without money format to see possibly a for each loop? got for each in and looped over the object now need to see if we can deconstruct the object to get only price to add money? then looped over the array of objects and only got price out now just need to add them and display
      function addMoney() {
        var j = 0;
        var carNames = [];
        for (var i = 0; i < items.length; i++) {
          var nameOfCar = items[i];
          if (nameOfCar.hasOwnProperty("price")) {
            carNames[j] = nameOfCar["price"];
            j++;
          }
        }

        console.log(carNames);
      }
      // items.forEach((item) => {
      //    for (let key in item) {
      //     console.log(`${key} : ${item[key]}`);
      //    }
      //  });
      // need to fix check box UI for removing items from list
      function populateList(bits = [], bitsList) {
        bitsList.innerHTML = bits
          .map((bit, i) => {
            return `
          <li>
            <input type="checkbox" data-index=${i} id="item${i}" ${
              bit.done ? "checked" : null
            } />
            <label for="item${i}">${bit.text + " " + bit.price}</label>
           </li>

          `;
          })
          .join("");
      }

      function toggleDone(e) {
        if (!e.target.matches("input")) return; // skip this unless its an input we want to target the input not the other elements
        const el = e.target;
        const index = el.dataset.index;
        items[index].done = !items[index].done;
        localStorage.setItem("items", JSON.stringify(items));
        populateList(items, itemsList);
      }

      addItems.addEventListener("submit", addItem);
      itemsList.addEventListener("click", toggleDone);
      // this button will trigger function to add money then reformat before displaying it to page
      total.addEventListener("click", addMoney);

      populateList(items, itemsList);
      // need to listen for click on bits section as this is actually there on page load unlike the list items. So pass to parent they send to list item childs not rendered yet
    </script>
  </body>
</html>
